###########################################################################
#
# This program is part of Zenoss Core, an open source monitoring platform.
# Copyright (C) 2010, Zenoss Inc.
#
# This program is free software; you can redistribute it and/or modify it
# under the terms of the GNU General Public License version 2 as published by
# the Free Software Foundation.
#
# For complete information please visit: http://www.zenoss.com/oss/
#
###########################################################################

PROTODIR = zenoss/protocols/protobufs
DATADIR = zenoss/protocols/data
PROTOC = protoc
default: build

define QJS_BUILD
import json
from pprint import pformat
data = json.load(open("../interface/src/zenoss.qjs", "r"))

print "# Generated by Zenoss build, do not modify directly"
print 'SCHEMA = %s' % pformat(data, 4)
endef
export QJS_BUILD

build:
	mkdir -p ${PROTODIR} && touch ${PROTODIR}/__init__.py
	$(PROTOC) -I ../interface/src/protobufs/ --python_out=${PROTODIR} ../interface/src/protobufs/*.proto
	mkdir -p ${DATADIR} && touch ${DATADIR}/__init__.py
	python -c "$$QJS_BUILD" > ${DATADIR}/queueschema.py

clean:
	rm -rf ${PROTODIR}
	rm -rf build
	rm -rf dist
	rm -rf zenoss.protocols.egg-info
	rm -rf ${DATADIR}
